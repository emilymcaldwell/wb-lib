/*! wb-lib | https://github.com/emilymcaldwell/wb-lib/blob/main/LICENSE */
const t=(t,e,s)=>new MutationObserver((i=>{for(const n of i){const i=n.attributeName,o=n.target;"childList"===n.type?(n.removedNodes.forEach((t=>s(o,t))),n.addedNodes.forEach((t=>e(o,t)))):i&&t(o,i)}})),e=Object.assign,s=Object.freeze,i=Math.max,n=Math.min,o=clearTimeout,r=setTimeout,l=(t,s)=>t&&s?e(t.style,s):t?.style??null,a=t=>t+"px",h=t=>t?.classList??null,c=(t,e,s)=>h(t)?.toggle(e,s)??null,u=(t,e)=>c(t,e,!1)??null,d=(t,e)=>t?.getAttribute(e)??null,p=(t,e)=>{return s=`[${e}]`,(t?.matches(s)?t:t?.closest(s))??null;var s},m=(t,e,s)=>e&&(s?t?.setAttribute(e,s):t?.removeAttribute(e)),f=(t,e)=>{return(s=d(t,e))&&m(t,e,null),s;var s},E=(t,e,s,i)=>e.appendChild(t.createElement(s,i)),g=t=>t.parentElement??null,b=t=>t.nextElementSibling??null,x=(t,e)=>t.querySelector(e),v=(t,e)=>t.querySelectorAll(e),y=(t,e)=>t.matches(e),S=(t,e)=>[...y(t,e)?[t]:[],...v(t,e)],C=t=>[t,...v(t,"*")],L=t=>t?.ownerDocument,D=(t,e)=>t?.includes(e)??!1,M=(t,e,s)=>t?.addEventListener(e,s),T=(t,e,s)=>t?.removeEventListener(e,s),w=(t,e,s)=>e.forEach((e=>M(t,e,s))),H=(t,e,s)=>e.forEach((e=>T(t,e,s))),I=t=>t instanceof HTMLElement,O=t=>t instanceof HTMLAudioElement,k=t=>O(t)?t:null,Q=t=>t instanceof MouseEvent,R="target",V="indicator",W="source",A="margin",N="delay",z="loiter",$="simultaneous",j="title",q="data-"+j,F="click",P="mousedown",U="mousemove",X="mouseout",Y="mouseover",B=s([Y,X,P,F]);class G extends HTMLElement{static QN="tipps-visor";static QR=s([G]);#t;#e;#s=null;#i="";#n=null;#o;#r;#l=()=>h(this.firstElementChild);constructor(){super();const t=this.attachShadow({mode:"closed"}),e=L(t),s=this.#t=E(e,t,"div");l(s,{position:"absolute",pointerEvents:"none",zIndex:"-1"}),this.#e=E(e,s,"slot")}get#a(){return d(this,V)??"active"}get#h(){return d(this,W)??j}get#c(){return+(d(this,A)??0)||4}get#u(){return+(d(this,N)??0)||700}get#d(){return+(d(this,z)??0)||300}static observedAttributes=s([R,V,W,A,N,z]);attributeChangedCallback(t,e,s){if(t===V){const t=this.#l();t?.contains(e)&&(t.remove(e),t.add(s))}}handleEvent(t){Q(t)&&(t.type===U&&this.#p(t),t.type===Y?this.#m(t):D([X,P,F],t.type)&&this.onTippsDown(t))}#f(t=null){(x(this,"slot[name=prompt]")??this.#e).innerText=t??""}#p=t=>{const e=L(this.#s)?.defaultView;if(!e)return;const s=(o=this.#t,o?.getBoundingClientRect());var o;const r=new DOMRect(t.pageX,t.pageY,18,18),h=function(t,e){const s=2*e;return new DOMRect(t.scrollX+e,t.scrollY+e,t.innerWidth-s,t.innerHeight-s)}(e,this.#c),c=new DOMPoint(r.x,r.y-s.height),u=new DOMPoint(i(0,h.left-c.x)+n(0,h.right-(c.x+s.width)),i(0,h.top-c.y)+n(0,h.bottom-c.y));c.x+=u.x?u.x:r.width*(u.y/s.height),c.y+=u.y,c.x=n(c.x,h.right-s.width),c.y=n(c.y,h.bottom-s.height),l(this.#t,{left:a(c.x),top:a(c.y)})};#E(t,e){this.#o=void 0,this.#l()?.add(this.#a),this.#t.style.zIndex=e.style.zIndex??0,this.#f(this.#i),this.#p(t),M(L(e),U,this)}#m(t){const e=t.target;if(I(e)){if(this.#h===j){this.#n=p(e,j);const t=f(this.#n,j);m(this.#n,q,t),this.#i=t&&t.length?t:e.innerText}else{const t=(s=e,i=this.#h,d(p(s,i),i));this.#i=t&&t.length?t:e.innerText}this.#s=e,this.#r?(this.#r=o(this.#r),this.#E(t,e)):this.#o=r((()=>this.#E(t,e)),this.#u)}var s,i}#g(){this.#r=void 0,this.#f(),this.#i="",this.#t.style.zIndex="-1",this.#l()?.remove(this.#a)}onTippsDown(t){this.#n&&m(this.#n,j,f(this.#n,q)),this.#o=o(this.#o),this.#r=o(this.#r),T(L(this.#s),U,this),!t||D([F,P],t.type)?this.#g():this.#r=r((()=>this.#g()),this.#d),this.#s=null}}const J=G.observedAttributes;class K extends HTMLElement{static QN="tipps";static QR=s([...G.QR,K]);#b=new WeakSet;#x=new G;#v=t(((t,e)=>{t===this?e===R?this.connectedCallback():D(J,e)&&m(this.#x,e,d(this,e)):(this.#y(t),this.#S(t))}),((t,e)=>t===this&&this.children.length?this.#x.replaceChildren(...this.children):this.#S(e)),((t,e)=>this.#y(e)));#y(t){if(I(t))for(const e of C(t))I(e)&&this.#b.delete(e)&&H(e,B,this.#x)}#S(t){const e=d(this,R);if(e&&I(t))for(const s of S(t,e))I(s)&&!this.#b.has(s)&&(this.#b.add(s),w(s,B,this.#x))}connectedCallback(){const t=g(this);t&&(J.forEach((t=>m(this.#x,t,d(this,t)))),this.#x.onTippsDown(null),this.#y(t),this.#S(t),this.#v.disconnect(),this.#v.observe(t,{childList:!0,subtree:!0,attributeFilter:J}),L(this).body.appendChild(this.#x).append(...this.children))}}const Z=s(["play","pause","ended"]),_=s([R,V,$]);class tt extends HTMLElement{static QN="tmblr-audio";static QR=s([tt]);#b=new WeakMap;get#a(){return d(this,V)??"playing"}get#C(){return!!d(this,$)}#v=t(((t,e)=>{t===this&&D(_,e)?this.connectedCallback():(this.#y(t),this.#S(t))}),((t,e)=>this.#S(e)),((t,e)=>this.#y(e)));#y(t){if(I(t))for(const e of C(t)){const t=this.#b.get(e);this.#b.delete(e)&&(T(e,P,this),H(e,Z,this),u(e,this.#a),O(e)||l(g(e),{backgroundImage:t}))}}#S(t){const e=d(this,R);if(e&&I(t))for(const s of S(t,e))if(I(s)&&!this.#b.has(s)){const t=g(s);t&&(M(s,P,this),c(s,this.#a,!(k(b(s))?.paused??1)),this.#b.set(s,l(t)?.backgroundImage??""),l(t,{backgroundImage:`url(${x(s,"img")?.src})`}))}}handleEvent(t){const e=t.target;if(Q(t)&&I(e)){const t=b(e);if(O(t))if(this.#b.has(t)||(w(t,Z,this),this.#b.set(t,"")),t.paused){if(!this.#C){const t=g(this);t&&S(t,"audio").forEach((t=>t.pause()))}t.play()}else t.pause()}else D(Z,t.type)&&O(e)&&c(e.previousElementSibling??null,this.#a,!e.paused)}connectedCallback(){const t=g(this);t&&(this.#y(t),this.#S(t),this.#v.disconnect(),this.#v.observe(t,{childList:!0,subtree:!0,attributeFilter:_}))}}[...K.QR,...tt.QR].forEach((t=>customElements.define(`wb-${t.QN}`,t)));
