/*! wb-lib | https://github.com/emilymcaldwell/wb-lib/blob/main/LICENSE */
const t=(t,e,s)=>new MutationObserver((i=>{for(const n of i){const i=n.attributeName;"childList"===n.type?(n.removedNodes.forEach(e),n.addedNodes.forEach(s)):i&&t(n.target,i)}})),e=Object.assign,s=Object.freeze,i=Math.max,n=Math.min,o=clearTimeout,a=setTimeout,r=(t,s)=>t&&s?e(t.style,s):t?.style??null,l=t=>t+"px",h=t=>t?.classList??null,c=(t,e,s)=>h(t)?.toggle(e,s)??null,d=(t,e)=>c(t,e,!1)??null,u=(t,e)=>t?.getAttribute(e)??null,p=(t,e,s)=>e&&(s?t?.setAttribute(e,s):t?.removeAttribute(e)),m=(t,e,s,i)=>e.appendChild(t.createElement(s,i)),f=t=>t.parentElement??null,b=t=>t.nextElementSibling??null,g=(t,e)=>t.querySelector(e),E=(t,e)=>t.querySelectorAll(e),y=(t,e)=>t.matches(e),x=(t,e)=>[...y(t,e)?[t]:[],...E(t,e)],v=t=>[t,...E(t,"*")],L=t=>t?.ownerDocument,S=(t,e)=>t?.includes(e)??!1,D=(t,e,s)=>t?.addEventListener(e,s),C=(t,e,s)=>t?.removeEventListener(e,s),M=(t,e,s)=>e.forEach((e=>D(t,e,s))),w=(t,e,s)=>e.forEach((e=>C(t,e,s))),H=t=>t instanceof HTMLElement,I=t=>t instanceof HTMLAudioElement,O=t=>I(t)?t:null,T=t=>t instanceof MouseEvent,k="target",Q="indicator",R="source",W="margin",V="delay",A="loiter",N="simultaneous",z="click",$="mousedown",j="mousemove",q="mouseout",F="mouseover",P=s([F,q,$,z]);class U extends HTMLElement{static QN="tipps-visor";static QR=s([U]);#t;#e;#s=null;#i;#n;#o=()=>h(this.firstElementChild);constructor(){super();const t=this.attachShadow({mode:"closed"}),e=L(t),s=this.#t=m(e,t,"div");r(s,{position:"absolute",pointerEvents:"none",zIndex:"-1"}),this.#e=m(e,s,"slot")}get#a(){return u(this,Q)??"active"}get#r(){return u(this,R)??"title"}get#l(){return+(u(this,W)??0)||4}get#h(){return+(u(this,V)??0)||700}get#c(){return+(u(this,A)??0)||300}static observedAttributes=s([k,Q,R,W,V,A]);attributeChangedCallback(t,e,s){if(t===Q){const t=this.#o();t?.contains(e)&&(t.remove(e),t.add(s))}}handleEvent(t){T(t)&&(t.type===j&&this.#d(t),t.type===F?this.#u(t):S([q,$,z],t.type)&&this.onTippsDown(t))}#p(t=null){(g(this,"slot[name=prompt]")??this.#e).innerText=t??""}#d=t=>{const e=L(this.#s)?.defaultView;if(!e)return;const s=(o=this.#t,o?.getBoundingClientRect());var o;const a=new DOMRect(t.pageX,t.pageY,18,18),h=function(t,e){const s=2*e;return new DOMRect(t.scrollX+e,t.scrollY+e,t.innerWidth-s,t.innerHeight-s)}(e,this.#l),c=new DOMPoint(a.x,a.y-s.height),d=new DOMPoint(i(0,h.left-c.x)+n(0,h.right-(c.x+s.width)),i(0,h.top-c.y)+n(0,h.bottom-c.y));c.x+=d.x?d.x:a.width*(d.y/s.height),c.y+=d.y,c.x=n(c.x,h.right-s.width),c.y=n(c.y,h.bottom-s.height),r(this.#t,{left:l(c.x),top:l(c.y)})};#m(t,e){var s,i,n;this.#i=void 0,this.#o()?.add(this.#a),this.#t.style.zIndex=e.style.zIndex??0,this.#p((s=e,i=this.#r,u((n=`[${i}]`,s?.matches(n)?s:s?.closest(n)),i))),this.#d(t),D(L(e),j,this)}#u(t){const e=t.target;H(e)&&(this.#s=e,this.#n?(this.#n=o(this.#n),this.#m(t,e)):this.#i=a((()=>this.#m(t,e)),this.#h))}#f(){this.#n=void 0,this.#p(),this.#t.style.zIndex="-1",this.#o()?.remove(this.#a)}onTippsDown(t){this.#i=o(this.#i),this.#n=o(this.#n),C(L(this.#s),j,this),!t||S([z,$],t.type)?this.#f():this.#n=a((()=>this.#f()),this.#c),this.#s=null}}const X=U.observedAttributes;class Y extends HTMLElement{static QN="tipps";static QR=s([...U.QR,Y]);#b=new WeakSet;#g=new U;#E=t(((t,e)=>{t===this?e===k?this.connectedCallback():S(X,e)&&p(this.#g,e,u(this,e)):(this.#y(t),this.#x(t))}),(t=>this.#x(t)),(t=>this.#x(t)));#y(t){if(H(t))for(const e of v(t))H(e)&&this.#b.delete(e)&&w(e,P,this.#g)}#x(t){const e=u(this,k);if(e&&H(t))for(const s of x(t,e))H(s)&&!this.#b.has(s)&&(this.#b.add(s),M(s,P,this.#g))}connectedCallback(){const t=f(this);t&&(X.forEach((t=>p(this.#g,t,u(this,t)))),this.#g.onTippsDown(null),this.#y(t),this.#x(t),this.#E.disconnect(),this.#E.observe(t,{childList:!0,subtree:!0,attributeFilter:X}),L(this).body.appendChild(this.#g).append(...this.children))}}const B=s(["play","pause","ended"]),G=s([k,Q,N]);class J extends HTMLElement{static QN="tmblr-audio";static QR=s([J]);#b=new WeakMap;get#a(){return u(this,Q)??"playing"}get#v(){return!!u(this,N)}#E=t(((t,e)=>{t===this&&S(G,e)?this.connectedCallback():(this.#y(t),this.#x(t))}),(t=>this.#x(t)),(t=>this.#x(t)));#y(t){if(H(t))for(const e of v(t)){const t=this.#b.get(e);this.#b.delete(e)&&(C(e,$,this),w(e,B,this),d(e,this.#a),I(e)||r(f(e),{backgroundImage:t}))}}#x(t){const e=u(this,k);if(e&&H(t))for(const s of x(t,e))if(H(s)&&!this.#b.has(s)){const t=f(s);t&&(D(s,$,this),c(s,this.#a,!(O(b(s))?.paused??1)),this.#b.set(s,r(t)?.backgroundImage??""),r(t,{backgroundImage:`url(${g(s,"img")?.src})`}))}}handleEvent(t){const e=t.target;if(T(t)&&H(e)){const t=b(e);if(I(t))if(this.#b.has(t)||(M(t,B,this),this.#b.set(t,"")),t.paused){if(!this.#v){const t=f(this);t&&x(t,"audio").forEach((t=>t.pause()))}t.play()}else t.pause()}else S(B,t.type)&&I(e)&&c(e.previousElementSibling??null,this.#a,!e.paused)}connectedCallback(){const t=f(this);t&&(this.#y(t),this.#x(t),this.#E.disconnect(),this.#E.observe(t,{childList:!0,subtree:!0,attributeFilter:G}))}}[...Y.QR,...J.QR].forEach((t=>customElements.define(`wb-${t.QN}`,t)));
