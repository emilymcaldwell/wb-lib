/*! wb-lib | https://github.com/emilymcaldwell/wb-lib/blob/main/LICENSE */
const t=Object.assign,e=Object.freeze,s=Math.max,i=Math.min,n=clearTimeout,o=setTimeout,r=(e,s)=>t(e.style,s),a=t=>t+"px",l=(t,e)=>t?.getAttribute(e)??null,h=(t,e,s)=>e&&(s?t?.setAttribute(e,s):t?.removeAttribute(e)),c=(t,e,s,i)=>e.appendChild(t.createElement(s,i)),d=(t,e)=>t.querySelectorAll(e),p=(t,e)=>t.matches(e),u=t=>t?.ownerDocument,m=(t,e)=>t?.includes(e)??!1,f="target",E="indicator",y="source",v="margin",L="delay",b="loiter",x="click",g="mousedown",M="mousemove",D="mouseout",H="mouseover",C=e([H,D,g,x]);class w extends HTMLElement{static QN="tipps-visor";static QR=e([w]);#t;#e;#s=null;#i;#n;#o=()=>this.firstElementChild?.classList??null;constructor(){super();const t=this.attachShadow({mode:"closed"}),e=u(t),s=this.#t=c(e,t,"div");r(s,{position:"absolute",pointerEvents:"none"}),this.#r(0,0),this.#e=c(e,s,"slot")}get#a(){return l(this,E)??"active"}get#l(){return l(this,y)??"title"}get#h(){return+(l(this,v)??0)||4}get#c(){return+(l(this,L)??0)||700}get#d(){return+(l(this,b)??0)||300}static observedAttributes=e([f,E,y,v,L,b]);attributeChangedCallback(t,e,s){if(t===E){const t=this.#o();t?.contains(e)&&(t.remove(e),t.add(s))}}handleEvent(t){t instanceof MouseEvent&&(t.type===M&&this.#p(t),t.type===H?this.#u(t):m([D,g,x],t.type)&&this.onTippsDown(t))}#m(t=null){(this.querySelector("slot[name=prompt]")??this.#e).innerText=t??""}#r(t,e){r(this.#t,{left:a(t),top:a(e)})}#p=t=>{const e=u(this.#s)?.defaultView;if(!e)return;const n=(o=this.#t,o?.getBoundingClientRect());var o;const r=new DOMRect(t.pageX,t.pageY,18,18),a=function(t,e){const s=2*e;return new DOMRect(t.scrollX+e,t.scrollY+e,t.innerWidth-s,t.innerHeight-s)}(e,this.#h),l=new DOMPoint(r.x,r.y-n.height),h=new DOMPoint(s(0,a.left-l.x)+i(0,a.right-(l.x+n.width)),s(0,a.top-l.y)+i(0,a.bottom-l.y));l.x+=h.x?h.x:r.width*(h.y/n.height),l.y+=h.y,l.x=i(l.x,a.right-n.width),l.y=i(l.y,a.bottom-n.height),this.#r(l.x,l.y)};#f(t,e){var s,i,n;this.#i=void 0,this.#o()?.add(this.#a),this.#t.style.zIndex=e.style.zIndex??0,this.#m((s=e,i=this.#l,l((n=`[${i}]`,s?.matches(n)?s:s?.closest(n)),i))),this.#p(t),u(e).addEventListener(M,this)}#u(t){const e=t.target;e instanceof HTMLElement&&(this.#s=e,this.#n?(this.#n=n(this.#n),this.#f(t,e)):this.#i=o((()=>this.#f(t,e)),this.#c))}#E(){this.#n=void 0,this.#m(),this.#t.style.zIndex="-1",this.#o()?.remove(this.#a)}onTippsDown(t){this.#i=n(this.#i),this.#n=n(this.#n),u(this.#s)?.removeEventListener(M,this),!t||m([x,g],t.type)?this.#E():this.#n=o((()=>this.#E()),this.#d),this.#s=null}}const S=w.observedAttributes;class T extends HTMLElement{static QN="tipps";static QR=e([...w.QR,T]);#y=new WeakSet;#v=new w;#L=new MutationObserver((t=>{for(const e of t){let t=e.attributeName,s=e.target;s===this&&t?t===f?this.connectedCallback():m(S,t)&&h(this.#v,t,l(this,t)):"childList"===e.type?(e.removedNodes.forEach((t=>this.#b(t))),e.addedNodes.forEach((t=>this.#x(t)))):"attributes"===e.type&&(this.#b(s),this.#x(s))}}));#b(t){if(t instanceof HTMLElement)for(const e of(t=>[t,...d(t,"*")])(t))e instanceof HTMLElement&&this.#y.delete(e)&&C.forEach((t=>e.removeEventListener(t,this.#v)))}#x(t){const e=l(this,f);if(e&&t instanceof HTMLElement)for(const s of((t,e)=>[...p(t,e)?[t]:[],...d(t,e)])(t,e))s instanceof HTMLElement&&!this.#y.has(s)&&(this.#y.add(s),C.forEach((t=>s.addEventListener(t,this.#v))))}connectedCallback(){const t=this.parentNode;t&&(S.forEach((t=>h(this.#v,t,l(this,t)))),this.#v.onTippsDown(null),this.#b(t),this.#x(t),this.#L.disconnect(),this.#L.observe(t,{childList:!0,subtree:!0,attributeFilter:S}),u(this).body.appendChild(this.#v).append(...this.children))}}[...T.QR].forEach((t=>customElements.define(`wb-${t.QN}`,t)));
