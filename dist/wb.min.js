/*! wb-lib | https://github.com/emilymcaldwell/wb-lib/blob/main/LICENSE */
const t=Object.assign,e=Object.freeze,s=Math.max,i=Math.min,n=clearTimeout,o=setTimeout,r=(e,s)=>t(e.style,s),a=(t,e)=>t?.getAttribute(e)??null,h=(t,e,s)=>e&&(s?t?.setAttribute(e,s):t?.removeAttribute(e)),l=(t,e,s,i)=>e.appendChild(t.createElement(s,i)),c=(t,e)=>t.querySelectorAll(e),d=(t,e)=>t.matches(e),u=t=>t?.getBoundingClientRect(),p=t=>t?.ownerDocument,m=(t,e)=>t?.includes(e)??!1,f="target",E="indicator",y="source",v="pursue",L="margin",b="delay",g="loiter",x="click",M="mousedown",C="mousemove",D="mouseout",H="mouseover",w=e([H,D,M,x]);class S extends HTMLElement{static QN="tipps-visor";static QR=e([S]);#t;#e;#s=null;#i;#n;#o=()=>this.firstElementChild?.classList??null;constructor(){super();const t=this.attachShadow({mode:"closed"}),e=p(t),s=this.#t=l(e,t,"div");r(s,{position:"absolute",pointerEvents:"none"}),this.#r(0,0),this.#e=l(e,s,"slot")}get#a(){return a(this,E)??"active"}get#h(){return a(this,y)??"title"}get#l(){if(!this.hasAttribute(v))return!1;const t=a(this,v);return!t||!/^\s*(false|0|off)\s*$/i.test(t)}get#c(){return+(a(this,L)??0)||4}get#d(){return+(a(this,b)??0)||700}get#u(){return+(a(this,g)??0)||300}static observedAttributes=e([f,E,y,v,L,b,g]);attributeChangedCallback(t,e,s){if(t===E){const t=this.#o();t?.contains(e)&&(t.remove(e),t.add(s))}}handleEvent(t){t instanceof MouseEvent&&(t.type===C&&this.#p(t),t.type===H?this.#m(t):m([D,M,x],t.type)&&this.onTippsDown(t))}#f(t=null){(this.querySelector("slot[name=prompt]")??this.#e).innerText=t??""}#r(t,e){r(this.#t,{left:t+"px",top:e+"px"})}#p=t=>{const e=p(this.#s)?.defaultView;if(!e)return;const n=u(this.#t),o=new DOMRect(t.pageX,t.pageY,18,18),r=function(t,e){const s=2*e;return new DOMRect(t.scrollX+e,t.scrollY+e,t.innerWidth-s,t.innerHeight-s)}(e,this.#c),a=new DOMPoint(o.x,o.y-n.height),h=new DOMPoint(s(0,r.left-a.x)+i(0,r.right-(a.x+n.width)),s(0,r.top-a.y)+i(0,r.bottom-a.y));a.x+=h.x?h.x:o.width*(h.y/n.height),a.y+=h.y,a.x=i(a.x,r.right-n.width),a.y=i(a.y,r.bottom-n.height),this.#r(a.x,a.y)};#E(t,e){var s,i,n;if(this.#i=void 0,this.#o()?.add(this.#a),this.#t.style.zIndex=e.style.zIndex??0,this.#f((s=e,i=this.#h,a((n=`[${i}]`,s?.matches(n)?s:s?.closest(n)),i))),this.#l)this.#p(t),p(e).addEventListener(C,this);else{const t=u(e);this.#r(t.right-this.#c,t.bottom-this.#c)}}#m(t){const e=t.target;e instanceof HTMLElement&&(this.#n?(this.#n=n(this.#n),this.#E(t,this.#s=e)):(this.#s=e,this.#i=o((()=>this.#E(t,e)),this.#d)))}#y(){this.#n=void 0,this.#f(),this.#t.style.zIndex="-1",this.#o()?.remove(this.#a)}onTippsDown(t){this.#i=n(this.#i),this.#n=n(this.#n),p(this.#s)?.removeEventListener(C,this),!t||m([x,M],t.type)?this.#y():this.#n=o((()=>this.#y()),this.#u),this.#s=null}}const T=S.observedAttributes;class O extends HTMLElement{static QN="tipps";static QR=e([...S.QR,O]);#v=new WeakSet;#L=new S;#b=new MutationObserver((t=>{for(const e of t){let t=e.attributeName,s=e.target;s===this&&t?t===f?this.connectedCallback():m(T,t)&&h(this.#L,t,a(this,t)):"childList"===e.type?(e.removedNodes.forEach((t=>this.#g(t))),e.addedNodes.forEach((t=>this.#x(t)))):"attributes"===e.type&&(this.#g(s),this.#x(s))}}));#g(t){if(t instanceof HTMLElement)for(const e of(t=>[t,...c(t,"*")])(t))e instanceof HTMLElement&&this.#v.delete(e)&&w.forEach((t=>e.removeEventListener(t,this.#L)))}#x(t){const e=a(this,f);if(e&&t instanceof HTMLElement)for(const s of((t,e)=>[...d(t,e)?[t]:[],...c(t,e)])(t,e))s instanceof HTMLElement&&!this.#v.has(s)&&(this.#v.add(s),w.forEach((t=>s.addEventListener(t,this.#L))))}connectedCallback(){const t=this.parentNode;t&&(T.forEach((t=>h(this.#L,t,a(this,t)))),this.#L.onTippsDown(null),this.#g(t),this.#x(t),this.#b.disconnect(),this.#b.observe(t,{childList:!0,subtree:!0,attributeFilter:T}),p(this).body.appendChild(this.#L).append(...this.children))}}[...O.QR].forEach((t=>customElements.define(`wb-${t.QN}`,t)));
